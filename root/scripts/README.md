# Скрипты

## Описание

Приложение для управления скриптами. В данный момент доступны следующие скрипты:
* **Бэкап базы данных** - регулярный дамп базы данных PostgreSQL и отправка дампа по электронной почте администраторам.

## Структура

* `apps.py` - модуль, инициализирующий приложение.
* `models.py` - модели приложения.
* `admin.py` - отображение моделей в административном интерфейсе Django.
* `urls.py` - маршруты для запуска скриптов.
* `views.py` - непосредственно скрипты.

## Бизнес-логика

Для выполнения задач используется две модели:
1. Скрипт - название скрипта, описание и ссылка для запуска.
2. Запуск - обособленный процесс выполнения скрипта.

Иными словами, скрипт - это задача, её описание и способ запуска. Запуск - это хранение информации о состоянии выполнения задачи. У одного скрипта может быть много запусков, но один запуск может быть связан только с одним скриптом. Это взаимсовязь определена через `ForeignKey`.

При создании объекта "Скрипт" заполняется поле slug, который используется для создания абсолютного URL, по которому вызывается запуск скрипта. Допустим, у скрипта slug `destroy-all-humans`. Тогда абсолютный путь для запуска данного скрипта будет выглядеть следующим образом: `https://<domain_name>/scripts/destroy-all-humans`.

При использовании данного URL происходит вызов скрипта -> Django вытаскивает из базы данных объект скрипта, соответствующий данному пути -> создает объект "Запуска" со статусом "Выполняется". Далее в случае успешного выполнения скрипта объект "Запуска" сохраняется со статусом "Завершено", флагом успешного выполнения, а также фиксируются результат выполнения и лог. В случае ошибки выполнения скрипта объект "Запуска" также сохраняется со статусом "Завершено", но с флагом неуспешного выполнения и текстом ошибки в качестве результата.

Запуск скрипта по расписанию можно настроить через cron, используя команду `curl <URL>`, где URL - это полный путь для запуска скрипта (например, `curl https://<domain_name>/scripts/destroy-all-humans`). Вручную запустить скрипт можно через административный интерфейс, где также доступны просмотр истории запусков и логи.